<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Nonogram Puzzle [[${puzzleId}]]</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
	<link rel="stylesheet" href="/css/style.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
	<a class="navbar-brand" href="/">Nonogram</a>
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
		<span class="navbar-toggler-icon"></span>
	</button>
	<div class="collapse navbar-collapse" id="navbarNav">
		<ul class="navbar-nav">
			<li class="nav-item">
				<a class="nav-link" href="/">Home</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/game/1">Game</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/leaderboard">Leaderboard</a>
			</li>
		</ul>
		<ul class="navbar-nav ml-auto">
			<li class="nav-item">
				<a class="nav-link btn btn-outline-primary" href="/login">Login</a>
			</li>
		</ul>
	</div>
</nav>

<div class="container" style="padding-top: 56px;">
	<h2>Puzzle [[${puzzleId}]]</h2>
	<div id="nonogram"></div>
	<div>
		<button id="submitBtn">제출</button>
	</div>
	<div>
		<h3>스톱워치</h3>
		<p id="stopwatch">00:00:00</p>
	</div>
	<div>
		<h3>순위표</h3>
		<ul>
			<li th:each="record : ${topRecords}">
				<span th:text="${record.username}">Username</span> - <span th:text="${record.timeTaken}">Time</span> ms
			</li>
		</ul>
	</div>
</div>

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const puzzleId = [[${puzzleId}]]; // Thymeleaf 변수를 사용
        const nonogramContainer = document.getElementById("nonogram");

        // 예시 퍼즐 데이터 (10x10)
        const puzzleData = [
            [0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,],
            [0,0,0,0,0,0,0,0,0,0,]
        ];

        const grid = document.createElement("div");
        grid.style.display = "grid";
        grid.style.gridTemplateColumns = "repeat(10, 30px)";
        grid.style.gridTemplateRows = "repeat(10, 30px)";
        grid.style.gap = "1px";

        puzzleData.forEach(row => {
            row.forEach(cell => {
                const cellElement = document.createElement("div");
                cellElement.style.width = "30px";
                cellElement.style.height = "30px";
                cellElement.style.border = "1px solid black";
                cellElement.style.backgroundColor = cell ? "black" : "white";
                cellElement.addEventListener("click", () => {
                    cellElement.style.backgroundColor = cellElement.style.backgroundColor === "black" ? "white" : "black";
                });
                grid.appendChild(cellElement);
            });
        });

        nonogramContainer.appendChild(grid);

        // 스톱워치
        let stopwatchInterval;
        let stopwatchTime = 0;
        const stopwatchElement = document.getElementById("stopwatch");

        function startStopwatch() {
            stopwatchInterval = setInterval(() => {
                stopwatchTime += 1000;
                const hours = String(Math.floor(stopwatchTime / 3600000)).padStart(2, '0');
                const minutes = String(Math.floor((stopwatchTime % 3600000) / 60000)).padStart(2, '0');
                const seconds = String(Math.floor((stopwatchTime % 60000) / 1000)).padStart(2, '0');
                stopwatchElement.textContent = `${hours}:${minutes}:${seconds}`;
            }, 1000);
        }

        startStopwatch();

        document.getElementById("submitBtn").addEventListener("click", function() {
            const username = prompt("Enter your username:");
            const solution = "사용자가 입력한 정답"; // 사용자가 입력한 정답을 가져오는 로직 필요
            fetch("/submit", {
                method: "POST",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                body: `puzzleId=${puzzleId}&username=${username}&timeTaken=${stopwatchTime}&solution=${solution}`
            })
                .then(response => response.text())
                .then(data => alert(data));
        });
    });
</script>
</body>
</html>
